rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Legacy tops collection - backward compatibility
    match /tops/{document} {
      allow read: if true;
      // Only allow writes from server-side (admin SDK)
      allow write: if false;
    }
    
    // New rankings collection - optimized for queries
    match /rankings/{document} {
      allow read: if true;
      allow list: if true;
      // Only allow writes from server-side (admin SDK)
      allow write: if false;
    }
    
    // Player details with enhanced data
    match /players-points-details/{uniqueIndex} {
      allow read: if true;
      // Allow listing with pagination limits
      allow list: if request.query.limit <= 50;
      // Only allow writes from server-side (admin SDK)
      allow write: if false;
    }
    
    // Region summaries for dashboard
    match /region-summaries/{document} {
      allow read: if true;
      allow list: if true;
      // Only allow writes from server-side (admin SDK)
      allow write: if false;
    }
    
    // Computation metadata
    match /computation-metadata/{weekDocument} {
      allow read: if true;
      allow list: if true;
      // Only allow writes from server-side (admin SDK)  
      allow write: if false;
    }
    
    // Legacy livescore collection
    match /livescore/{documents=**} {
      allow read, list: if true;
      // Only allow writes from server-side (admin SDK)
      allow write: if false;
    }
  }
}